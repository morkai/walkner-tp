// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

/* eslint-disable no-var */

'use strict';

const jsonDeepEqual = require('./jsonDeepEqual');

module.exports = function jsonDeepEqualLeft(a, b)
{
  if (a === b)
  {
    return true;
  }

  var aType = typeof a;

  if (aType !== typeof b || aType !== 'object')
  {
    return false;
  }

  if (a == null || b == null || a.prototype !== b.prototype)
  {
    return false;
  }

  if (a instanceof Date)
  {
    return a.getTime() === b.getTime();
  }

  var i;
  var l;

  if (Array.isArray(aType))
  {
    l = a.length;

    if (!Array.isArray(b) || l !== b.length)
    {
      return false;
    }

    for (i = 0; i < l; ++i)
    {
      if (!jsonDeepEqual(a[i], b[i]))
      {
        return false;
      }
    }

    return true;
  }

  if (typeof a.equals === 'function' && Object.getPrototypeOf(a) !== Object.prototype)
  {
    return a.equals(b);
  }

  if (typeof b.equals === 'function' && Object.getPrototypeOf(b) !== Object.prototype)
  {
    return b.equals(a);
  }

  var aKeys = Object.keys(a);
  var bKeys = Object.keys(b);

  l = aKeys.length;

  if (l > bKeys.length)
  {
    return false;
  }

  for (i = 0; i < l; ++i)
  {
    var k = aKeys[i];

    if (!jsonDeepEqual(a[k], b[k]))
    {
      return false;
    }
  }

  return true;
};
