// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

'use strict';

const fs = require('fs/promises');

module.exports = async (app, module, req, res) =>
{
  res.sendStatus(204);

  const user = module.user.createUserInfo(req.session.user, req);
  const users = JSON.parse(await fs.readFile(req.file.path, 'utf8'));

  module.syncUsers({user, users}, () =>
  {
    fs.unlink(req.file.path, () => {});
  });
};
